name: Create a new release of the overlay
on: workflow_dispatch
jobs:
  prepare-release:
    name: Prepare the release
    runs-on: ubuntu-latest
    steps:
      - name: Download the repo
        uses: actions/checkout@v4
      - name: Get the overlay version
        run: |
            echo "OVERLAY_VERSION=$(cat metadata.txt | grep "Version: " | cut -c 10-)" >> $GITHUB_ENV
      - name: Put the repo into the ZIP archive
        run: |
          rm -rf HitErrorMeter.by.KapiWilq.zip
          cd ../
          cp -r HitErrorMeter HitErrorMeter\ by\ KapiWilq
          zip -r HitErrorMeter.by.KapiWilq.zip HitErrorMeter\ by\ KapiWilq -x "HitErrorMeter\ by\ KapiWilq/.git/*" "HitErrorMeter\ by\ KapiWilq/.github/*" "HitErrorMeter\ by\ KapiWilq/README.md"
          mv HitErrorMeter.by.KapiWilq.zip HitErrorMeter/
      - name: Publish a new release
        uses: softprops/action-gh-release@v2
        with:
          name: v${{ env.OVERLAY_VERSION }}
          tag_name: v${{ env.OVERLAY_VERSION }}
          token: ${{ secrets.GITHUBPAT }}
          body: |
            Thanks for wanting to try out my overlay!

            ## Changelog
            - To be done (if it's not here within 24 hours after the release then yell at me)
          fail_on_unmatched_files: true
          files: HitErrorMeter.by.KapiWilq.zip
          make_latest: true

